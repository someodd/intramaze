# Contributing and Repo Guidelines

If you change anything be sure to check that things still build in Docker,
`nix-build`, and `nix-shell`.

If you are contributing, please work within `nix-shell`.

Try to stay within the `nix-shell` to keep all of our environments the same.

Here are some nice things about the Nix shell:

  * `cabal build`: the environment is setup with everything you need to
    consistently build the project with a version of `cabal` it includes
  * `haskell-langauge-server`: you can use in combination with the *Haskell* and
    *Nix Environment Selector* VSCode/VSCodium extensions (formatter, linter,
    documentation, suggestions, etc). Make sure you click "selected" when you
    get the pop up in the lower right with Nix Environment Selector.
  * `postgres`: in case you want to run a postgres server yourself (instead of
    using Docker)
  * `doctest`: so  you can run the doctests in `src`!
  * `cabal2nix`: so you can easily update `default.nix` in case of any changes
    to dependencies
  * `docker` and `docker-compose`, so you can run those commands in the shell
    (see this README's section on Docker)

If you're contributing to this project I'd prefer you to do so within
`nix-shell` and use `nix-build` before you push a commit.

For your editor to use the tools in `nix-shell`, simply launch the editor in the
`nix-shell`. For example, I had to launch `codium` via a terminal inside the
`nix-shell` environment.

Please note that `default.nix` is automatically generated by `cabal2nix`.

## Style

  * Use Fourmolo for formatting. Please see this repo's `fourmolu.yaml`.

## Documentation

  * https://kowainik.github.io/posts/haddock-tips
  * https://haskell-haddock.readthedocs.io/en/latest/

## `git`

Grouping tokens (short tokens prefixing a branch name, like `tooling/nix`)
used:

  * `tooling`: used for anything related to devops, docker, changes that aren't
    specifically related to the software.

## Adding a dependency

Make sure to pin a specific version of the dependency you want in the
`interwebz.cabal` and make sure that such version available in the pinned
nixpkgs version (see `shell.nix` or `release.nix`). I recommend just following
this process:

  1. [Search nixpkgs for the dependency you want to add](https://search.nixos.org/packages)
  1. Add dependency without bounds to `interwebz.cabal` (if it's a Haskell
     package? what about system libraries that can go in the cabal file too?)
  1. If you added a Haskell package dependency then run: `nix-shell --packages cabal2nix --run "cabal2nix ." > default.nix`
  1. Run `nix-build` and see which version of the package it resolves for the
     dependency and pin that version in `interwebz.cabal` (if a Haskell package, I guess)